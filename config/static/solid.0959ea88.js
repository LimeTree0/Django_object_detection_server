const d={context:void 0,registry:void 0};function _(e){d.context=e}function fe(){return{...d.context,id:`${d.context.id}${d.context.count++}-`,count:0}}const ce=(e,t)=>e===t,xe=Symbol("solid-proxy"),ae=Symbol("solid-track"),V={equals:ce};let ee=re;const L=1,H=2,te={owned:null,cleanups:null,context:null,owner:null},W={};var f=null;let X=null,o=null,b=null,E=null,F=0;function Y(e,t){const s=o,n=f,r=e.length===0,u=t===void 0?n:t,i=r?te:{owned:null,cleanups:null,context:u?u.context:null,owner:u},c=r?e:()=>e(()=>C(()=>q(i)));f=i,o=null;try{return $(c,!0)}finally{o=s,f=n}}function T(e,t){t=t?Object.assign({},V,t):V;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),se(s,r));return[ne.bind(s),n]}function J(e,t,s){const n=K(e,t,!0,L);R(n)}function Se(e,t,s){const n=K(e,t,!1,L);R(n)}function ke(e,t,s){ee=be;const n=K(e,t,!1,L),r=z&&pe(z);r&&(n.suspense=r),(!s||!s.render)&&(n.user=!0),E?E.push(n):R(n)}function M(e,t,s){s=s?Object.assign({},V,s):V;const n=K(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,R(n),ne.bind(n)}function de(e){return e&&typeof e=="object"&&"then"in e}function Ae(e,t,s){let n,r,u;arguments.length===2&&typeof t=="object"||arguments.length===1?(n=!0,r=e,u=t||{}):(n=e,r=t,u=s||{});let i=null,c=W,v=null,w=!1,l="initialValue"in u,j=typeof n=="function"&&M(n);const p=new Set,[x,N]=(u.storage||T)(u.initialValue),[A,I]=T(void 0),[O,S]=T(void 0,{equals:!1}),[m,k]=T(l?"ready":"unresolved");if(d.context){v=`${d.context.id}${d.context.count++}`;let a;u.ssrLoadFrom==="initial"?c=u.initialValue:d.load&&(a=d.load(v))&&(c=a)}function y(a,h,g,U){return i===a&&(i=null,U!==void 0&&(l=!0),(a===c||h===c)&&u.onHydrated&&queueMicrotask(()=>u.onHydrated(U,{value:h})),c=W,B(h,g)),h}function B(a,h){$(()=>{h===void 0&&N(()=>a),k(h!==void 0?"errored":l?"ready":"unresolved"),I(h);for(const g of p.keys())g.decrement();p.clear()},!1)}function G(){const a=z,h=x(),g=A();if(g!==void 0&&!i)throw g;return o&&!o.user&&a&&J(()=>{O(),i&&(a.resolved||p.has(a)||(a.increment(),p.add(a)))}),h}function Q(a=!0){if(a!==!1&&w)return;w=!1;const h=j?j():n;if(h==null||h===!1){y(i,C(x));return}const g=c!==W?c:C(()=>r(h,{value:x(),refetching:a}));return de(g)?(i=g,"value"in g?(g.status==="success"?y(i,g.value,void 0,h):y(i,void 0,void 0,h),g):(w=!0,queueMicrotask(()=>w=!1),$(()=>{k(l?"refreshing":"pending"),S()},!1),g.then(U=>y(g,U,void 0,h),U=>y(g,void 0,ue(U),h)))):(y(i,g,void 0,h),g)}return Object.defineProperties(G,{state:{get:()=>m()},error:{get:()=>A()},loading:{get(){const a=m();return a==="pending"||a==="refreshing"}},latest:{get(){if(!l)return G();const a=A();if(a&&!i)throw a;return x()}}}),j?J(()=>Q(!1)):Q(!1),[G,{refetch:Q,mutate:N}]}function Ee(e){return $(e,!1)}function C(e){if(o===null)return e();const t=o;o=null;try{return e()}finally{o=t}}function he(e){return f===null||(f.cleanups===null?f.cleanups=[e]:f.cleanups.push(e)),e}function Ce(){return o}function pe(e){return f&&f.context&&f.context[e.id]!==void 0?f.context[e.id]:e.defaultValue}let z;function ne(){if(this.sources&&this.state)if(this.state===L)R(this);else{const e=b;b=null,$(()=>D(this),!1),b=e}if(o){const e=this.observers?this.observers.length:0;o.sources?(o.sources.push(this),o.sourceSlots.push(e)):(o.sources=[this],o.sourceSlots=[e]),this.observers?(this.observers.push(o),this.observerSlots.push(o.sources.length-1)):(this.observers=[o],this.observerSlots=[o.sources.length-1])}return this.value}function se(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&$(()=>{for(let r=0;r<e.observers.length;r+=1){const u=e.observers[r],i=X&&X.running;i&&X.disposed.has(u),(i?!u.tState:!u.state)&&(u.pure?b.push(u):E.push(u),u.observers&&le(u)),i||(u.state=L)}if(b.length>1e6)throw b=[],new Error},!1)),t}function R(e){if(!e.fn)return;q(e);const t=f,s=o,n=F;o=f=e,ge(e,e.value,n),o=s,f=t}function ge(e,t,s){let n;try{n=e.fn(t)}catch(r){return e.pure&&(e.state=L,e.owned&&e.owned.forEach(q),e.owned=null),e.updatedAt=s+1,ie(r)}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?se(e,n):e.value=n,e.updatedAt=s)}function K(e,t,s,n=L,r){const u={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:f,context:f?f.context:null,pure:s};return f===null||f!==te&&(f.owned?f.owned.push(u):f.owned=[u]),u}function P(e){if(e.state===0)return;if(e.state===H)return D(e);if(e.suspense&&C(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<F);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===L)R(e);else if(e.state===H){const n=b;b=null,$(()=>D(e,t[0]),!1),b=n}}function $(e,t){if(b)return e();let s=!1;t||(b=[]),E?s=!0:E=[],F++;try{const n=e();return we(s),n}catch(n){s||(E=null),b=null,ie(n)}}function we(e){if(b&&(re(b),b=null),e)return;const t=E;E=null,t.length&&$(()=>ee(t),!1)}function re(e){for(let t=0;t<e.length;t++)P(e[t])}function be(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:P(n)}if(d.context){if(d.count){d.effects||(d.effects=[]),d.effects.push(...e.slice(0,s));return}else d.effects&&(e=[...d.effects,...e],s+=d.effects.length,delete d.effects);_()}for(t=0;t<s;t++)P(e[t])}function D(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const n=e.sources[s];if(n.sources){const r=n.state;r===L?n!==t&&(!n.updatedAt||n.updatedAt<F)&&P(n):r===H&&D(n,t)}}}function le(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=H,s.pure?b.push(s):E.push(s),s.observers&&le(s))}}function q(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const u=r.pop(),i=s.observerSlots.pop();n<r.length&&(u.sourceSlots[i]=n,r[n]=u,s.observerSlots[n]=i)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)q(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function ue(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ie(e,t=f){throw ue(e)}const me=Symbol("fallback");function Z(e){for(let t=0;t<e.length;t++)e[t]()}function ye(e,t,s={}){let n=[],r=[],u=[],i=0,c=t.length>1?[]:null;return he(()=>Z(u)),()=>{let v=e()||[],w,l;return v[ae],C(()=>{let p=v.length,x,N,A,I,O,S,m,k,y;if(p===0)i!==0&&(Z(u),u=[],n=[],r=[],i=0,c&&(c=[])),s.fallback&&(n=[me],r[0]=Y(B=>(u[0]=B,s.fallback())),i=1);else if(i===0){for(r=new Array(p),l=0;l<p;l++)n[l]=v[l],r[l]=Y(j);i=p}else{for(A=new Array(p),I=new Array(p),c&&(O=new Array(p)),S=0,m=Math.min(i,p);S<m&&n[S]===v[S];S++);for(m=i-1,k=p-1;m>=S&&k>=S&&n[m]===v[k];m--,k--)A[k]=r[m],I[k]=u[m],c&&(O[k]=c[m]);for(x=new Map,N=new Array(k+1),l=k;l>=S;l--)y=v[l],w=x.get(y),N[l]=w===void 0?-1:w,x.set(y,l);for(w=S;w<=m;w++)y=n[w],l=x.get(y),l!==void 0&&l!==-1?(A[l]=r[w],I[l]=u[w],c&&(O[l]=c[w]),l=N[l],x.set(y,l)):u[w]();for(l=S;l<p;l++)l in A?(r[l]=A[l],u[l]=I[l],c&&(c[l]=O[l],c[l](l))):r[l]=Y(j);r=r.slice(0,i=p),n=v.slice(0)}return r});function j(p){if(u[l]=p,c){const[x,N]=T(l);return c[l]=N,t(v[l],x)}return t(v[l])}}}let oe=!1;function Le(){oe=!0}function Ne(e,t){if(oe&&d.context){const s=d.context;_(fe());const n=C(()=>e(t||{}));return _(s),n}return C(()=>e(t||{}))}const ve=e=>`Stale read from <${e}>.`;function $e(e){const t="fallback"in e&&{fallback:()=>e.fallback};return M(ye(()=>e.each,e.children,t||void 0))}function je(e){const t=e.keyed,s=M(()=>e.when,void 0,{equals:(n,r)=>t?n===r:!n==!r});return M(()=>{const n=s();if(n){const r=e.children;return typeof r=="function"&&r.length>0?C(()=>r(t?n:()=>{if(!C(s))throw ve("Show");return e.when})):r}return e.fallback},void 0,void 0)}export{xe as $,$e as F,je as S,Se as a,Y as b,Ne as c,ae as d,Le as e,Ee as f,Ce as g,T as h,Ae as i,ke as j,d as s,C as u};
